<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
    <title>dynups webui</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <script src="./js/jquery-1.10.2.min.js"></script>
    <script src="./js/mustache.min.js"></script>
	<script src="./js/bootstrap.min.js"></script>
	</head> 
<body class="table-responsive">
	<h2>NGX DYN Upstream</h2>
	<button class='btn btn-primary' id='lst'>List</button>
	<div class="container">
	<div id=users_info></div>
	</div>
</body> 
<script type="text/javascript">

$(document).ready(function(){
	$("#lst").click(function(){
		var str_json = '{"code":0,"message":[{"upsname":"http_upsname","number":2,"total_weight":2,"type":"http","peers":[{"name":"127.0.0.1:10001","server":"localhost:10001","current_weight":0,"effective_weight":1,"weight":1,"conns":0,"max_conns":0,"fails":0,"max_fails":1,"fail_timeout":10,"slow_start":0,"start_time":0,"down":false,"backup":false},{"name":"[::1]:10001","server":"localhost:10001","current_weight":0,"effective_weight":1,"weight":1,"conns":0,"max_conns":0,"fails":0,"max_fails":1,"fail_timeout":10,"slow_start":0,"start_time":0,"down":false,"backup":false}]},{"upsname":"stream_upsname","number":1,"total_weight":1,"type":"stream","peers":[{"name":"127.0.0.1:10002","server":"127.0.0.1:10002","current_weight":0,"effective_weight":1,"weight":1,"conns":0,"max_conns":0,"fails":0,"max_fails":1,"fail_timeout":10,"slow_start":0,"start_time":0,"down":false,"backup":false}]}]}';
		var str_obj = JSON.parse(str_json);
		//if.......
		var data = { ups: str_obj.message };
		var template = '<div><table class="table table-condensed table-bordered"><thead><tr><th>upsname</th><th>type</th><th>number</th><th>totalweight</th><th>peers list</th></tr></thead><tbody>{{#ups}}<tr><td>{{upsname}}</td><td>{{type}}</td><td>{{number}}</td><td>{{total_weight}}</td><td><table class="table table-bordered"><thead><tr><th>name</th><th>server</th><th>weight</th><th>f_tm</th><th>dn</th><th>bk</th></tr></thead><tbody>{{#peers}}<tr><td>{{name}}</td><td>{{server}}</td><td>{{weight}}</td><td>{{fail_timeout}}</td><td>{{down}}</td><td>{{backup}}</td></tr>{{/peers}}</tbody></table></td></tr>{{/ups}}</tbody></table><div>';  
		var views = Mustache.render(template, data);  
		$("#users_info").html(views);  
	});
});

</script>
</html>
